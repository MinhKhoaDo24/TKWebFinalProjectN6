<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Movie Stream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f172a; color: white; scroll-behavior: smooth; }
        .aspect-video-container { position: relative; padding-bottom: 56.25%; height: 0; background: #000; }
        .aspect-video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="font-sans">

    <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 z-40 hidden backdrop-blur-sm transition-opacity"></div>

    <div class="flex min-h-screen">
        
        <aside id="sidebar-container" class="fixed inset-y-0 left-0 z-50 w-72 transform -translate-x-full md:translate-x-0 md:static transition-all duration-300 bg-slate-900 border-r border-slate-800">
            </aside>

        <div class="flex-1 flex flex-col min-w-0">
            
            <header id="navbar-container" class="sticky top-0 z-30 bg-slate-900/80 backdrop-blur-md"></header>

            <main class="container mx-auto px-4 py-8">
                <section id="playerSection" class="hidden mb-12 animate-fadeIn">
                    <div class="bg-black rounded-xl overflow-hidden shadow-2xl ring-1 ring-slate-700">
                        <div class="aspect-video-container" id="videoWrapper"></div>
                        <div class="p-6 bg-slate-900 border-t border-slate-800">
                            <h2 id="playingTitle" class="text-2xl md:text-3xl font-bold mb-2"></h2>
                            <div class="flex flex-wrap gap-4 text-sm text-slate-400 mb-4" id="playingMeta"></div>
                            <p id="playingDesc" class="text-slate-300 leading-relaxed max-w-4xl text-sm md:text-base"></p>
                        </div>
                    </div>
                </section>

                <div id="movieGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <div class="col-span-full py-20 text-center text-slate-500">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-blue-500 mb-4"></div>
                        <p>Đang tải dữ liệu từ hệ thống...</p>
                    </div>
                </div>

                <footer id="footer-container" class="mt-20"></footer>
            </main>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    
    <script>
        let moviesData = [];
        async function loadMovies() {
            try {
                const response = await fetch('./data/movies.json'); 
                if (!response.ok) throw new Error('Không tìm thấy file movies.json');
                moviesData = await response.json();
                displayMovies(moviesData);
            } catch (error) {
                console.error("Lỗi:", error);
                document.getElementById('movieGrid').innerHTML = `<div class="col-span-full text-center text-red-500">Lỗi tải dữ liệu!</div>`;
            }
        }

        function displayMovies(data) {
            const movieGrid = document.getElementById('movieGrid');
            if (data.length === 0) {
                movieGrid.innerHTML = `<div class="col-span-full text-center py-20 text-slate-500 italic">Không có phim.</div>`;
                return;
            }
            movieGrid.innerHTML = data.map(movie => {
                const releaseYear = movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A';
                return `
                <div class="movie-card group cursor-pointer animate-fadeIn" onclick="playMovie(${movie.id})">
                    <div class="relative overflow-hidden rounded-xl bg-slate-800 aspect-[2/3] mb-3 shadow-lg ring-1 ring-white/5 group-hover:ring-blue-500 transition-all">
                        <img src="${movie.poster_url}" alt="${movie.title}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500" onerror="this.src='https://placehold.co/400x600/1e293b/white?text=No+Image'">
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <div class="w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center shadow-xl transform scale-90 group-hover:scale-100 transition">
                                <i class="fas fa-play text-white text-lg ml-1"></i>
                            </div>
                        </div>
                    </div>
                    <h3 class="font-bold text-sm md:text-base line-clamp-1 group-hover:text-blue-400 transition">${movie.title}</h3>
                </div>`;
            }).join('');
        }

        function playMovie(id) {
            const movie = moviesData.find(m => m.id === id);
            if (!movie || !movie.embed_url) return;
            document.getElementById('playerSection').classList.remove('hidden');
            document.getElementById('videoWrapper').innerHTML = `<iframe src="${movie.embed_url}" frameborder="0" allowfullscreen></iframe>`;
            document.getElementById('playingTitle').innerText = movie.title;
            document.getElementById('playingDesc').innerText = movie.description;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        $(document).ready(function() {
            loadMovies();
        });
    </script>

    <script src="scripts/loadheaderfooter.js"></script>
</body>
</html>